{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 18, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Farid/Desktop/urlexpanderapi/pages/api/expand.js"],"sourcesContent":["import axios from 'axios';\r\n\r\n// Browser-like headers to avoid 403 blocks from URL shorteners\r\nconst browserHeaders = {\r\n  'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36',\r\n  'Accept': 'text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8',\r\n  'Accept-Language': 'en-US,en;q=0.5',\r\n  'Accept-Encoding': 'gzip, deflate, br',\r\n  'Connection': 'keep-alive',\r\n  'Upgrade-Insecure-Requests': '1',\r\n};\r\n\r\n// Extract URL from HTML meta refresh or JavaScript redirects\r\nfunction extractUrlFromHtml(html, originalUrl) {\r\n  // Try meta refresh: <meta http-equiv=\"refresh\" content=\"0;url=...\">\r\n  const metaRefreshMatch = html.match(/<meta[^>]+http-equiv=[\"']?refresh[\"']?[^>]+content=[\"']?\\d+;\\s*url=([^\"'\\s>]+)/i);\r\n  if (metaRefreshMatch) {\r\n    return metaRefreshMatch[1];\r\n  }\r\n\r\n  // Try meta property og:url or twitter:url\r\n  const ogUrlMatch = html.match(/<meta[^>]+(?:property|name)=[\"']?(?:og:url|twitter:url)[\"']?[^>]+content=[\"']?([^\"'\\s>]+)/i);\r\n  if (ogUrlMatch) {\r\n    return ogUrlMatch[1];\r\n  }\r\n\r\n  // Try canonical link\r\n  const canonicalMatch = html.match(/<link[^>]+rel=[\"']?canonical[\"']?[^>]+href=[\"']?([^\"'\\s>]+)/i);\r\n  if (canonicalMatch) {\r\n    return canonicalMatch[1];\r\n  }\r\n\r\n  // Try JavaScript redirect: window.location = \"...\" or location.href = \"...\"\r\n  const jsRedirectMatch = html.match(/(?:window\\.)?location(?:\\.href)?\\s*=\\s*[\"']([^\"']+)[\"']/i);\r\n  if (jsRedirectMatch) {\r\n    return jsRedirectMatch[1];\r\n  }\r\n\r\n  // Try title attribute with URL (t.co specific): <title>https://...</title>\r\n  const titleMatch = html.match(/<title>([^<]+)<\\/title>/i);\r\n  if (titleMatch && titleMatch[1].startsWith('http')) {\r\n    return titleMatch[1];\r\n  }\r\n\r\n  // Try noscript meta refresh\r\n  const noscriptMatch = html.match(/<noscript>.*?<meta[^>]+http-equiv=[\"']?refresh[\"']?[^>]+content=[\"']?\\d+;\\s*url=([^\"'\\s>]+)/is);\r\n  if (noscriptMatch) {\r\n    return noscriptMatch[1];\r\n  }\r\n\r\n  return null;\r\n}\r\n\r\n// Function to expand URL by following redirects\r\nasync function expandUrl(shortUrl) {\r\n  try {\r\n    // First, try a GET request to capture both HTTP redirects and HTML-based redirects\r\n    const response = await axios.get(shortUrl, {\r\n      maxRedirects: 10,\r\n      headers: browserHeaders,\r\n      validateStatus: function (status) {\r\n        return status >= 200 && status < 400;\r\n      },\r\n      timeout: 10000,\r\n      // Don't decompress to avoid issues\r\n      decompress: true\r\n    });\r\n\r\n    // Check if we got redirected via HTTP\r\n    const httpRedirectUrl = response.request.res?.responseUrl || response.request?.responseURL;\r\n    \r\n    // If HTTP redirect happened and it's different from original, use it\r\n    if (httpRedirectUrl && httpRedirectUrl !== shortUrl) {\r\n      // But also check HTML for further redirects\r\n      if (typeof response.data === 'string') {\r\n        const htmlUrl = extractUrlFromHtml(response.data, httpRedirectUrl);\r\n        if (htmlUrl && htmlUrl !== httpRedirectUrl) {\r\n          return htmlUrl;\r\n        }\r\n      }\r\n      return httpRedirectUrl;\r\n    }\r\n\r\n    // No HTTP redirect, check HTML for meta refresh or JS redirect\r\n    if (typeof response.data === 'string') {\r\n      const htmlUrl = extractUrlFromHtml(response.data, shortUrl);\r\n      if (htmlUrl) {\r\n        return htmlUrl;\r\n      }\r\n    }\r\n\r\n    // No redirect found, return original URL\r\n    return shortUrl;\r\n\r\n  } catch (error) {\r\n    // If GET fails, try HEAD request as fallback\r\n    try {\r\n      const response = await axios.head(shortUrl, {\r\n        maxRedirects: 10,\r\n        headers: browserHeaders,\r\n        validateStatus: function (status) {\r\n          return status >= 200 && status < 400;\r\n        },\r\n        timeout: 10000\r\n      });\r\n\r\n      return response.request.res?.responseUrl || shortUrl;\r\n\r\n    } catch (headError) {\r\n      throw new Error(`Unable to expand URL: ${error.message}`);\r\n    }\r\n  }\r\n}\r\n\r\n// Validate URL format\r\nfunction isValidUrl(string) {\r\n  try {\r\n    const url = new URL(string);\r\n    return url.protocol === 'http:' || url.protocol === 'https:';\r\n  } catch (err) {\r\n    return false;\r\n  }\r\n}\r\n\r\nexport default async function handler(req, res) {\r\n  // Handle GET and POST requests\r\n  if (req.method === 'POST') {\r\n    try {\r\n      const { url } = req.body;\r\n\r\n      if (!url) {\r\n        return res.status(400).json({\r\n          error: 'URL is required',\r\n          message: 'Please provide a URL in the request body'\r\n        });\r\n      }\r\n\r\n      // Validate URL format\r\n      if (!isValidUrl(url)) {\r\n        return res.status(400).json({\r\n          error: 'Invalid URL format',\r\n          message: 'Please provide a valid URL'\r\n        });\r\n      }\r\n\r\n      const expandedUrl = await expandUrl(url);\r\n\r\n      res.json({\r\n        success: true,\r\n        shortUrl: url,\r\n        expandedUrl: expandedUrl,\r\n        timestamp: new Date().toISOString()\r\n      });\r\n\r\n    } catch (error) {\r\n      console.error('Error expanding URL:', error.message);\r\n      res.status(500).json({\r\n        error: 'Failed to expand URL',\r\n        message: error.message\r\n      });\r\n    }\r\n  } else if (req.method === 'GET') {\r\n    try {\r\n      const { url } = req.query;\r\n\r\n      if (!url) {\r\n        return res.status(400).json({\r\n          error: 'URL is required',\r\n          message: 'Please provide a URL as a query parameter: /api/expand?url=your_url'\r\n        });\r\n      }\r\n\r\n      // Validate URL format\r\n      if (!isValidUrl(url)) {\r\n        return res.status(400).json({\r\n          error: 'Invalid URL format',\r\n          message: 'Please provide a valid URL'\r\n        });\r\n      }\r\n\r\n      const expandedUrl = await expandUrl(url);\r\n\r\n      res.json({\r\n        success: true,\r\n        shortUrl: url,\r\n        expandedUrl: expandedUrl,\r\n        timestamp: new Date().toISOString()\r\n      });\r\n\r\n    } catch (error) {\r\n      console.error('Error expanding URL:', error.message);\r\n      res.status(500).json({\r\n        error: 'Failed to expand URL',\r\n        message: error.message\r\n      });\r\n    }\r\n  } else {\r\n    res.setHeader('Allow', ['GET', 'POST']);\r\n    res.status(405).json({ error: `Method ${req.method} Not Allowed` });\r\n  }\r\n}\r\n"],"names":[],"mappings":"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"}}]
}