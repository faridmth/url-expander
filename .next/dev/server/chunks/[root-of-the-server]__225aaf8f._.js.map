{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 18, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Farid/Desktop/urlexpanderapi/pages/api/expand.js"],"sourcesContent":["import axios from 'axios';\r\n\r\n// Browser-like headers to avoid 403 blocks from URL shorteners\r\nconst browserHeaders = {\r\n  'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36',\r\n  'Accept': 'text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8',\r\n  'Accept-Language': 'en-US,en;q=0.5',\r\n  'Accept-Encoding': 'gzip, deflate, br',\r\n  'Connection': 'keep-alive',\r\n  'Upgrade-Insecure-Requests': '1',\r\n};\r\n\r\n// Function to expand URL by following redirects\r\nasync function expandUrl(shortUrl) {\r\n  try {\r\n    // Make a HEAD request first (lighter than GET)\r\n    const response = await axios.head(shortUrl, {\r\n      maxRedirects: 10,\r\n      headers: browserHeaders,\r\n      validateStatus: function (status) {\r\n        return status >= 200 && status < 400; // Accept redirects and success\r\n      },\r\n      timeout: 10000 // 10 second timeout\r\n    });\r\n\r\n    // Return the final URL after following all redirects\r\n    return response.request.res.responseUrl || shortUrl;\r\n\r\n  } catch (error) {\r\n    // If HEAD fails, try GET request\r\n    try {\r\n      const response = await axios.get(shortUrl, {\r\n        maxRedirects: 10,\r\n        headers: browserHeaders,\r\n        validateStatus: function (status) {\r\n          return status >= 200 && status < 400;\r\n        },\r\n        timeout: 10000\r\n      });\r\n\r\n      return response.request.res.responseUrl || shortUrl;\r\n\r\n    } catch (getError) {\r\n      throw new Error(`Unable to expand URL: ${getError.message}`);\r\n    }\r\n  }\r\n}\r\n\r\n// Validate URL format\r\nfunction isValidUrl(string) {\r\n  try {\r\n    const url = new URL(string);\r\n    return url.protocol === 'http:' || url.protocol === 'https:';\r\n  } catch (err) {\r\n    return false;\r\n  }\r\n}\r\n\r\nexport default async function handler(req, res) {\r\n  // Handle GET and POST requests\r\n  if (req.method === 'POST') {\r\n    try {\r\n      const { url } = req.body;\r\n\r\n      if (!url) {\r\n        return res.status(400).json({\r\n          error: 'URL is required',\r\n          message: 'Please provide a URL in the request body'\r\n        });\r\n      }\r\n\r\n      // Validate URL format\r\n      if (!isValidUrl(url)) {\r\n        return res.status(400).json({\r\n          error: 'Invalid URL format',\r\n          message: 'Please provide a valid URL'\r\n        });\r\n      }\r\n\r\n      const expandedUrl = await expandUrl(url);\r\n\r\n      res.json({\r\n        success: true,\r\n        shortUrl: url,\r\n        expandedUrl: expandedUrl,\r\n        timestamp: new Date().toISOString()\r\n      });\r\n\r\n    } catch (error) {\r\n      console.error('Error expanding URL:', error.message);\r\n      res.status(500).json({\r\n        error: 'Failed to expand URL',\r\n        message: error.message\r\n      });\r\n    }\r\n  } else if (req.method === 'GET') {\r\n    try {\r\n      const { url } = req.query;\r\n\r\n      if (!url) {\r\n        return res.status(400).json({\r\n          error: 'URL is required',\r\n          message: 'Please provide a URL as a query parameter: /api/expand?url=your_url'\r\n        });\r\n      }\r\n\r\n      // Validate URL format\r\n      if (!isValidUrl(url)) {\r\n        return res.status(400).json({\r\n          error: 'Invalid URL format',\r\n          message: 'Please provide a valid URL'\r\n        });\r\n      }\r\n\r\n      const expandedUrl = await expandUrl(url);\r\n\r\n      res.json({\r\n        success: true,\r\n        shortUrl: url,\r\n        expandedUrl: expandedUrl,\r\n        timestamp: new Date().toISOString()\r\n      });\r\n\r\n    } catch (error) {\r\n      console.error('Error expanding URL:', error.message);\r\n      res.status(500).json({\r\n        error: 'Failed to expand URL',\r\n        message: error.message\r\n      });\r\n    }\r\n  } else {\r\n    res.setHeader('Allow', ['GET', 'POST']);\r\n    res.status(405).json({ error: `Method ${req.method} Not Allowed` });\r\n  }\r\n}\r\n"],"names":[],"mappings":"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"}}]
}